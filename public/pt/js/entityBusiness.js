"use strict";$(".w-header").load("./compontents/header.html"),$(".w-footer").load("./compontents/footer.html"),$(".w-firstFoot").load("./compontents/firstFoot.html",function(){$(".mark .mark-item dt").removeClass("avtive-dt"),$(".mark .mark-item dd").removeClass("avtive-dd"),$(".mark .itemOne").find("dt").addClass("avtive-dt"),$(".mark .itemOne").find("dd").addClass("avtive-dd")}),$(".w-model").load("./compontents/addBrand.html");var token=sessionStorage.getItem("token")||"",enterType=sessionStorage.getItem("enterType"),sendParamObj=JSON.parse(sessionStorage.getItem("sendParamObj"))||{},step1=JSON.parse(sessionStorage.getItem("step1")),isEditStatus=sessionStorage.getItem("isEditStatus"),loginInfo=JSON.parse(sessionStorage.getItem("loginInfo"));function getUserInfo(){ajaxPost("/store_v1/enter/getInfo",{token:token,store_id:loginInfo.store_id},function(t){if(1==t.status){sessionStorage.setItem("sendParamObj",JSON.stringify(t.data)),sendParamObj=t.data,sessionStorage.setItem("step1",JSON.stringify(t.data.step_one_data)),step1=t.data.step_one_data;for(var e="",n=0;n<step1.brand.length;n++){var a=step1.brand[n].isActive?"active":"",i=step1.brand[n].brand_type?"brand-type":"",s="no"==step1.brand[n].id?step1.brand[n].logo:base+step1.brand[n].logo;e+='<div class="cont-imgItem '+a+" "+i+'" id="'+step1.brand[n].id+'" logo="'+step1.brand[n].logo+'">\n       <img src="'+s+'" class="innerImg">\n       <img src="./images/img7.png" class="positionImg">\n       <input type="hidden" name="brand_id" value="'+step1.brand[n].id+'"/>\n   </div>'}$("#brandContHtml").html(e),getHangClassify()}})}function getBrandClassify(){ajaxPost("/store_v1/enter/getCateList",{token:token},function(t){if(1==t.status){for(var e=t.data,n="",a="",i=0;i<e.length;i++){var s="";if(e[i].children)for(var o=0;o<e[i].children.length;o++)s+='<li onclick="getBrandList('+e[i].children[o].id+')">'+e[i].children[o].cate_name+"</li>";n+='<div class="menu-item">\n         <div onclick="getBrandList(this,'+e[i].id+')">\n             <span class="fl">'+e[i].cate_name+'</span>\n             <img src="./images/img8.png" class="fr">\n         </div>\n         <ul>\n              '+s+"   \n         </ul>\n     </div>",a+='<li onclick="selectCateOne(this, '+e[i].id+')">'+e[i].cate_name+"</li>",0==i&&getClassifyTwo(e[i].id)}$("#contMenuLeft").html(n),$("#classifyUl_1").html(a)}else alert(t.msg)})}function getBrandList(t,e,n){if("./images/img88.png"!=$(t).find("img").attr("src")){var i=layer.load();ajaxPost("/store_v1/enter/getBrandList",{token:token,cate_id:e,key:n},function(t){if(layer.close(i),1==t.status){var e=t.data,n="";if(0<e.length)for(var a=0;a<e.length;a++)n+='<div class="cont-imgItem" id="'+e[a].id+'" logo="'+e[a].logo+'">\n       <img src="'+base+e[a].logo+'" class="innerImg">\n       <img src="./images/img7.png" class="positionImg">\n       <input type="hidden" name="brand_id" value="'+e[a].id+'"/>\n   </div>';2==enterType&&(n+='<div class="cont-imgItem" id="no" logo="./images/wupinpai.png">\n       <img src="./images/wupinpai.png" class="innerImg">\n       <img src="./images/img7.png" class="positionImg">\n       <input type="hidden" name="brand_id" value="no"/>\n   </div>'),$("#brandContHtml").html(n)}else $("#brandContHtml").html("")},function(){layer.close(i)})}}function getClassifyTwo(t){ajaxPost("/admin/brand_cate/cateList",{pid:t},function(t){if(1==t.status){var e=t.data.data,n="";if(0<e.length)for(var a=0;a<e.length;a++)n+='<li onclick="selectCateTwo(this, '+e[a].id+')">'+e[a].cate_name+"</li>";else n="<li>暂无数据</li>";$("#classifyUl_2").html(n)}})}function selectCateOne(t,e){var n=$(t).html();$(t).parents(".public-select").find("span").html(n),$("#addBrandModel input[name=cate_id]").val(e),getClassifyTwo(e),$("#publicSelect").find("span").html("请选择")}function selectCateTwo(t,e){var n=$(t).html();$(t).parents(".public-select").find("span").html(n),$("#addBrandModel input[name=cate_id]").val(e)}function editBrandLogoFn(){$("#fileBrandLogo").click()}function brandLogoChange(){var t=new FormData;t.append("file",$("#fileBrandLogo")[0].files[0]),t.append("token",token);var e=layer.load();uplaodImg("/store_v1/index/uploadFile",t,function(t){layer.close(e),1==t.status?($("#noUploadBox").hide(),$("#yesUploadBox").show(),$("#addBrandLogoImg").attr("src",base+t.data.src),$("#addBrandModel input[name=logo]").val(t.data.src)):layer.msg(t.msg)},function(t){layer.close(e)})}$(function(){if($(".addBrandImg").click(function(){$(".w-model").show()}),$("body").on("click","#contMenuLeft .menu-item div",function(){"./images/img88.png"==$(this).find("img").attr("src")?($(this).find("img").attr("src","./images/img8.png"),$(this).next("ul").hide(),$(this).parent(".menu-item").css({background:"#fff"})):($(this).find("img").attr("src","./images/img88.png"),$(this).next("ul").show(),$(this).parent(".menu-item").css({background:"#FAFAFA"}))}),$("body").on("click",".cont-imgItem",function(){var n=$(".cont-imgItem").index(this);$(".cont-imgItem").each(function(t,e){n==t?$(this).hasClass("active")?$(this).removeClass("active"):($(this).addClass("active"),$(this).hasClass("brand-type")?sendParamObj.brand_type=2:sendParamObj.brand_type=1):$(this).removeClass("active")})}),$("#searchSubmit").click(function(){getBrandList("","",$("input[name=keyword]").val())}),$("#editBrandLogo").click(function(){$("#fileBrandLogo").click()}),getBrandClassify(),isEditStatus)getUserInfo();else if(getHangClassify(),step1){for(var t="",e=0;e<step1.brand.length;e++){var n=step1.brand[e].isActive?"active":"",a=step1.brand[e].brand_type?"brand-type":"",i="no"==step1.brand[e].id?step1.brand[e].logo:base+step1.brand[e].logo;t+='<div class="cont-imgItem '+n+" "+a+'" id="'+step1.brand[e].id+'" logo="'+step1.brand[e].logo+'">\n       <img src="'+i+'" class="innerImg">\n       <img src="./images/img7.png" class="positionImg">\n       <input type="hidden" name="brand_id" value="'+step1.brand[e].id+'"/>\n   </div>'}$("#brandContHtml").html(t)}else getBrandList("","","")});var hDataList=[];function getHangClassify(){ajaxPost("/store_v1/enter/getIndustryCate",{token:token},function(t){if(1==t.status){var e="";e=step1?step1.hang:t.data;var n="",a="";if(0<(hDataList=e).length)for(var i=0;i<e.length;i++){var s="";if(e[i].children)for(var o=0;o<e[i].children.length;o++){s+='<div class="cont-textItem '+(e[i].children[o].isActive?"active":"")+'" id="'+e[i].children[o].id+'" name="'+e[i].children[o].cate_name+'">\n          <span onclick="selectHangClassify(this, '+i+", "+o+')">'+e[i].children[o].cate_name+'</span>\n          <img src="./images/delTwo.png" onclick="removeSelectHangClassify(this, '+i+", "+o+')">\n          <input type="hidden" name="cate_store_id" value="'+e[i].children[o].id+'"/>\n      </div>'}n+='<div class="hang-items" id="'+e[i].id+'" name="'+e[i].cate_name+'">\n          <div class="choose-type-title">'+e[i].cate_name+'</div>\n          <div class="cont-box clear">\n                 '+s+"  \n          </div>\n      </div>",a+='<div class="menu-item leftMenuHang" onclick="hangClassifyLeftSelect(this, '+i+')">\n            <div>\n                <span class="fl">'+e[i].cate_name+'</span>\n                <img src="./images/img8.png" class="fr">\n            </div>\n        </div>'}$("#rightHangClassify").html(n),$("#leftHangMenu").html(a)}else layer.msg(t.msg)},function(t){})}function hangClassifyLeftSelect(t,e){$("#rightHangClassify>.hang-items").eq(e).show().siblings().hide(),$(t).addClass("active").siblings().removeClass("active")}function selectHangClassify(t,e,n){$(t).parent(".cont-textItem").addClass("active"),hDataList[e].children[n].isActive=!0}function removeSelectHangClassify(t,e,n){$(t).parent(".cont-textItem").removeClass("active"),hDataList[e].children[n].isActive=!1}function gotoTwo(){var e=[],n={brand:[],hang:[]};if($("#brandContHtml>.cont-imgItem").each(function(){if(n.brand.push({id:$(this).attr("id"),logo:$(this).attr("logo"),isActive:!!$(this).hasClass("active"),brand_type:!!$(this).hasClass("brand-type")}),$(this).hasClass("active")){var t=$(this).find("input[name=brand_id]").val();"no"!=t&&e.push(t)}}),$("#brandContHtml>.cont-imgItem").each(function(){if($(this).hasClass("active"))return $(this).hasClass("brand-type")?sendParamObj.brand_type=2:sendParamObj.brand_type=1,!1}),1==enterType&&e.length<=0)return layer.msg("请选择品牌"),!1;var a=[];if($("#rightHangClassify>.hang-items").each(function(){$(this).find(".cont-textItem").each(function(){if($(this).hasClass("active")){var t=$(this).find("input[name=cate_store_id]").val();a.push(t)}})}),a.length<=0)return layer.msg("请选择行业分类"),!1;n.hang=hDataList,sendParamObj.brand_id=e.join(","),sendParamObj.cate_store_id=a,sessionStorage.setItem("sendParamObj",JSON.stringify(sendParamObj)),sessionStorage.setItem("step1",JSON.stringify(n)),ajaxPost("/store_v1/enter/saveTempData",{company_id:loginInfo.id,step:"1",content:JSON.stringify(n)},function(t){1==t.status?1==enterType?window.location.href="./brandInfo.html":2==enterType&&(0<e.length?window.location.href="./brandInfo.html":window.location.href="./aptitudes.html"):layer.msg(t.msg)})}